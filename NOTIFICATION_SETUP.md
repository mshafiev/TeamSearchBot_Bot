# Настройка системы автоматических уведомлений

## Описание

Система автоматически отправляет всем пользователям бота уведомления о новых анкетах каждые 5 дней (или другой настраиваемый интервал).

## Переменные окружения

Добавьте следующие переменные в ваш `.env` файл:

```bash
# Настройки рассылки уведомлений
NOTIFICATION_INTERVAL_DAYS=5
NOTIFICATION_DELAY_BETWEEN_MESSAGES=0.1

# ID администраторов (через запятую)
ADMIN_IDS=1008114047,another_admin_id

# Уровень логирования
LOG_LEVEL=INFO
```

### Параметры:

- `NOTIFICATION_INTERVAL_DAYS` - интервал между рассылками в днях (по умолчанию: 5)
- `NOTIFICATION_DELAY_BETWEEN_MESSAGES` - задержка между отправкой сообщений в секундах (по умолчанию: 0.1)
- `ADMIN_IDS` - список Telegram ID администраторов через запятую
- `LOG_LEVEL` - уровень логирования (INFO, DEBUG, WARNING, ERROR)

## Административные команды

После настройки администраторы могут использовать следующие команды:

- `/admin` - главное меню администратора
- `/send_notifications` - принудительно отправить уведомления всем пользователям
- `/test_notification <user_id>` - отправить тестовое уведомление конкретному пользователю
- `/stats` - показать статистику пользователей
- `/help_admin` - справка по командам

## Как это работает

1. При запуске бота автоматически запускается планировщик уведомлений
2. Каждые N дней (настраивается через `NOTIFICATION_INTERVAL_DAYS`) система:
   - Получает список всех пользователей из базы данных
   - Отправляет каждому пользователю уведомление о новых анкетах
   - Логирует результаты рассылки

3. Администраторы могут в любой момент принудительно запустить рассылку или отправить тестовое уведомление

## Безопасность

- Доступ к административным командам имеют только пользователи, чьи ID указаны в `ADMIN_IDS`
- Система автоматически обрабатывает ошибки и продолжает работу
- Между отправкой сообщений есть небольшая задержка, чтобы не перегружать Telegram API

## Логирование

Все действия системы логируются с указанием:
- Времени запуска/остановки планировщика
- Количества пользователей для рассылки
- Результатов отправки (успешно/ошибки)
- Ошибок при работе

## Устранение неполадок

1. **Рассылка не работает**: проверьте логи на наличие ошибок
2. **Не получается отправить тестовое уведомление**: убедитесь, что ваш ID добавлен в `ADMIN_IDS`
3. **Ошибки подключения к API**: проверьте настройки `DB_SERVER_HOST` и `DB_SERVER_PORT`
